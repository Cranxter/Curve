<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body>

    <div class="graph_container">
            <!-- World <br> 
            Hello <br> -->
    </div>

    <script type="text/javascript">
        // Your beautiful D3 code will go here

        var current_song = null
        var my_data = null

        function sleep(milliseconds) {
            var start = new Date().getTime();
            for (var i = 0; i < 1e7; i++) {
              if ((new Date().getTime() - start) > milliseconds){s
                break;
              }
            }
          }

        d3.json("./songs_data_v2.json").then(function(data) {
            
        console.log(data);
        my_data = data

        values = data
		
		
    var colors = ['#56CCF2', '#6FCF97','#F2C94C','#9B51E0','#F2994A','#EB5757','#BCEB57','#eb57bc','#4ceff2','#dfe6e9']
    
    cls_mapping = {'M ': 0, 'CO': 1, 'CL': 2, 'RO': 3, 'P ': 4, 'HH': 5, 'E ': 6, 'LR': 7}

		function random_number(maximum,minimum)
		{
			x =  Math.floor(Math.random() * (maximum - minimum + 1)) + minimum;
			return x;
		}

		var rad =  [4,6,5,8,10,14]
		
		var rad1 = [2,3,4]

        

    var h = 800
		var w = 1600
		
		var div = d3.select("body").append("div")	
    	.attr("class", "tooltip")				
    	.style("opacity", 0);

        var xScale = d3.scaleLinear()
        .domain([d3.min(values,function(d){return d.x}),d3.max(values,function(d) {return d.x})])
        .range([100,w-100])

        var yScale = d3.scaleLinear()
        .domain([d3.min(values,function(d){return d.y}),d3.max(values, function(d){return d.y})])
        .range([100,h-300])

        svg = d3.select(".graph_container").append("svg").attr("width",w).attr("height",h).attr("style","")
        //legends = d3.select(".graph_container").append("svg").attr("width","500").attr("height","50")

        svg.selectAll("rect")
        .data(colors)
        .enter()
        .append("rect")
        .attr("class","labels")
      .attr("x", function(d,i){return 400 + (i*80)})
      .attr("y", "700")
      .attr("width", "20")
      .attr("height", "20")
      .style("fill", function(d){return d});


        var simulation = d3.forceSimulation()
              
        
        simulation
        .force("charge_force", d3.forceManyBody().strength(-0.4))
        .force("center_force", d3.forceCenter(w / 2, h / 2))
        .force("collide", d3.forceCollide().radius(4).strength(2))
        
        simulation.stop()
 
        var circles = svg.selectAll("circle")
        .data(values)
        .enter()
		.append("circle")
		.attr("cx",function(d,i){return xScale(d.x)})
		.attr("cy",function(d,i) {return yScale(d.y)})
		//.attr("r",function(d){return rad[random_number(0,5)]})
		.attr("r",function(d){return 4})
		.style("fill",function(d) { return colors[random_number(9,0)]})
		.style("stroke","black")
		.style("stroke-width","2")
		.style("opacity","0.1")

/*
        x1 = circles.transition()
        //.delay(function(d,i){return i*0.1})
        .duration(0.2)
        .attr("cx",function(d,i)
         {var x = xScale(w/2)
        return w/2})
        .attr("cy", function(d) { return h/2})
        .attr("r", 4)
        .attr("fill","red")


       
*/

        
        x2 = circles.transition()
        .delay(700)
        .duration(900)
        .attr("cx",function(d,i)
         {var x = xScale(d.x)
        return x})
        .attr("cy", function(d) {return yScale(d.y)})
		//.attr("r", 8)
		.attr("r",function(d){return rad[random_number(0,2)]})
        .style("fill",function(d) { return colors[random_number(9,0)]})
		.style("opacity","0.7")
		
		x3 = x2.transition()
        .delay(2000)
        .duration(900)
        .attr("cx",function(d,i)
         {var x = xScale(d.x)
        return x})
        .attr("cy", function(d) {return yScale(d.y) + random_number(-5,5)})
		    .attr("r", 8)
		//.attr("r",function(d){return 1.5})
        .style("fill",function(d) {
          console.log(d.class)
         return colors[cls_mapping[d.class]]
        })
        .style("opacity","0.7")

		function tickActions() {
			//update circle positions to reflect node updates on each tick of the simulation 
			circles
				.attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; })
        
        
		  }

      simulation.on("tick", tickActions );
      
      //simulation.nodes(values);
      //simulation.alpha(2).restart();
      //simulation.start();

  

        circles.on("mouseover", function(d){d3.select(this).attr("r","20").style("fill","green").style("stroke-width","6") 
          
        var audio_file = new Audio('./Songs/'+d.name+'.mp3')
        console.log(audio_file)
        audio_file.play()
		current_song = audio_file
		
		div.transition()		
                .duration(200)		
                .style("opacity", .9);		
            div	.html( d.name + "<br/>")	
                .style("left", (d3.event.pageX+20) + "px")		
                .style("top", (d3.event.pageY - 28) + "px");
      
      })
        circles.on("mouseout", function(){d3.select(this).attr("r","8").transition().duration(700).style("fill","yellow")
      
		current_song.pause()
		div.transition()		
                .duration(100)		
                .style("opacity", 0);
      
      })
        //.transition()
        //.duration(1000)

        stopmusic = function(audio_file) { }

      });

      
        
    </script>
    
</body>
</html>